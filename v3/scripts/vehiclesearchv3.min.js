function Biltorvet(e){var t=e(document).find(".bdt .vehicle_search"),n=e(document).find(".bdt .vehicle_search_results"),l="",a=document.getElementById("frontpage_vehicle_search"),i=document.getElementById("vehicle_search_frontpage_button"),s=null,c=t.find(".lds-ring"),o=null,r=null,d=!1,u={CompanyIds:null,Propellant:null,Makes:null,Models:null,BodyTypes:null,ProductTypes:null,VehicleStates:null,FullTextSearch:null,PriceTypes:null,CustomVehicleTypes:null,PriceMin:null,PriceMax:null,ConsumptionMin:null,ConsumptionMax:null,Start:null,Limit:null,OrderBy:null,Ascending:null};function p(){return e.ajax({url:ajax_config.restUrl+"autoit-dealer-tools/v1/vehiclesearch/search",method:"POST",dataType:"json",data:{action:"vehicle_search",filter:u},cache:!1,success:function(t){e("#vehicle_search_results").html(t)},complete:function(){T(),h()}})}function m(){f(),e.ajax({url:ajax_config.restUrl+"autoit-dealer-tools/v1/filteroptions/savefilter",method:"POST",dataType:"json",data:{action:"save_filter",filter:u},cache:!1,success:function(e){window.location.href=l+"/?scroll=true"},complete:function(){h()}})}function v(){d?(r.bootstrapSlider("disable"),o.bootstrapSlider("disable")):(r.slider("disable"),o.slider("disable")),t.find("select").prop("disabled",!0)}function f(){c.hasClass("d-none")&&c.css("opacity",0).css("display","block").removeClass("d-none"),c.animate({opacity:1},1e3)}function h(){c.animate({opacity:0},200,function(){e(this).css("display","none").addClass("d-none")})}function y(){var e=n.find(".lds-ring-paging");e.hasClass("d-none")&&e.css("opacity",0).css("display","block").removeClass("d-none"),e.animate({opacity:1},1e3)}function T(){n.find(".lds-ring-paging").animate({opacity:0},200,function(){e(this).css("display","none").addClass("d-none")})}function S(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")}function $(e){for(var t="1",n=1;n<(""+e).length;n++)t+="0";return parseInt(t)}function b(e){a?(i.setAttribute("data-labelpattern","Vis "+e.totalResults+" resultater"),i.innerText="Vis "+e.totalResults+" resultater"):t.find(".search").text(t.find(".search").data("labelpattern").replace("%u",e.totalResults));var n="";for(var l in e.fullTextSearch)n+=e.fullTextSearch.value;t.find("input[name=fullTextSearch]").val(n),""!==n&&t.find("input[name=fullTextSearch]").removeAttr("disabled");var s="";for(var l in e.companies)s+='<option value="'+e.companies[l].key+'">'+e.companies[l].value+"</option>";t.find("select[name=company]").find("option:not(:first-child)").remove().end().append(s),""!==s&&t.find("select[name=company]").removeAttr("disabled");var c="";for(var l in e.makes)c+='<option value="'+e.makes[l].name+'">'+e.makes[l].name+"</option>";t.find("select[name=make]").find("option:not(:first-child)").remove().end().append(c),""!==c&&t.find("select[name=make]").removeAttr("disabled");var u="";for(var l in e.models)u+='<option value="'+e.models[l].name+'">'+e.models[l].name+"</option>";t.find("select[name=model]").find("option:not(:first-child)").remove().end().append(u),""!==u&&t.find("select[name=model]").removeAttr("disabled");var p="";for(var l in e.propellants)p+='<option value="'+e.propellants[l].name+'">'+e.propellants[l].name+"</option>";t.find("select[name=propellant]").find("option:not(:first-child)").remove().end().append(p),""!==p&&t.find("select[name=propellant]").removeAttr("disabled");var m="";for(var l in e.bodyTypes)m+='<option value="'+e.bodyTypes[l].name+'">'+e.bodyTypes[l].name+"</option>";t.find("select[name=bodyType]").find("option:not(:first-child)").remove().end().append(m),""!==m&&t.find("select[name=bodyType]").removeAttr("disabled");var v="";for(var l in e.vehicleStates)v+='<option value="'+e.vehicleStates[l].name+'">'+e.vehicleStates[l].name+"</option>";t.find("select[name=vehicleState]").find("option:not(:first-child)").remove().end().append(v),""!==v&&t.find("select[name=vehicleState]").removeAttr("disabled");var f="";for(var l in e.productTypes)f+='<option value="'+e.productTypes[l].name+'">'+e.productTypes[l].name+"</option>";t.find("select[name=productType]").find("option:not(:first-child)").remove().end().append(f),""!==f&&t.find("select[name=productType]").removeAttr("disabled");var h="";for(var l in e.priceTypes)h+='<option value="'+e.priceTypes[l].name+'">'+e.priceTypes[l].name+"</option>";t.find("select[name=priceType]").find("option:not(:first-child)").remove().end().append(h),""!==h&&t.find("select[name=priceType]").removeAttr("disabled"),null!==r&&(d?r.bootstrapSlider(e.consumptionMin===e.consumptionMax?"disable":"enable"):r.slider(e.consumptionMin===e.consumptionMax?"disable":"enable")).data("slider").setAttribute("min",e.consumptionMin).setAttribute("max",e.consumptionMax).setValue([null===e.values.consumptionMin?e.consumptionMin:e.values.consumptionMin,null===e.values.consumptionMax?e.consumptionMax:e.values.consumptionMax],!0,!0),null!==o&&(d?o.bootstrapSlider(e.priceMin===e.priceMax?"disable":"enable"):o.slider(e.priceMin===e.priceMax?"disable":"enable")).data("slider").setAttribute("min",e.priceMin).setAttribute("max",e.priceMax).setValue([null===e.values.priceMin?e.priceMin:e.values.priceMin,null===e.values.priceMax?e.priceMax:e.values.priceMax],!0,!0)}function g(){var e=o.data("slider").getValue()[0];e=-1===e?null:e;var l=o.data("slider").getValue()[1];l=-1===l?null:l;var a=r.data("slider").getValue()[0];a=-1===a?null:a;var i=r.data("slider").getValue()[1];i=-1===i?null:i,u={CompanyIds:""===t.find("select[name=company]").val()?null:[t.find("select[name=company]").val()],FullTextSearch:""===t.find("input[name=fullTextSearch]").val()?null:[t.find("input[name=fullTextSearch]").val()],Propellants:""===t.find("select[name=propellant]").val()?null:[t.find("select[name=propellant]").val()],Makes:""===t.find("select[name=make]").val()?null:[t.find("select[name=make]").val()],Models:""===t.find("select[name=model]").val()?null:[t.find("select[name=model]").val()],BodyTypes:""===t.find("select[name=bodyType]").val()?null:[t.find("select[name=bodyType]").val()],ProductTypes:""===t.find("select[name=productType]").val()?null:[t.find("select[name=productType]").val()],VehicleStates:""===t.find("select[name=vehicleState]").val()?null:[t.find("select[name=vehicleState]").val()],PriceTypes:""===t.find("select[name=priceType]").val()?null:[t.find("select[name=priceType]").val()],PriceMin:null!==o&&o.data("slider").getAttribute("min")!==e?e:null,PriceMax:null!==o&&o.data("slider").getAttribute("max")!==l?l:null,ConsumptionMin:null!==r&&r.data("slider").getAttribute("min")!==a?a:null,ConsumptionMax:null!==r&&r.data("slider").getAttribute("max")!==i?i:null,Start:null,Limit:null,OrderBy:""===n.find("select[name=orderBy]").val()?null:n.find("select[name=orderBy]").val(),Ascending:"asc"===n.find("select[name=ascDesc]").val()};var s=GetCustomVehicleType();s&&(u.CustomVehicleTypes=[s])}a&&(l=document.getElementById("root_url").textContent),this.Init=function(){if(e.bootstrapSlider&&(d=!0),e("#priceRange").length>0){var t={id:e(this).attr("id"),min:0,max:1e7,range:!0,value:[0,1e7],step:1,tooltip:"hide"};o=d?e("#priceRange").bootstrapSlider(t):e("#priceRange").slider(t)}if(e("#consumptionRange").length>0){var n={id:e(this).attr("id"),min:0,max:10,range:!0,value:[0,10],step:1,tooltip:"hide"};r=d?e("#consumptionRange").bootstrapSlider(n):e("#consumptionRange").slider(n)}this.ReloadUserFilterSelection(!0),this.PlaceholderShuffler()},this.PlaceholderShuffler=function(){element=t.find("input[name=fullTextSearch]");var e=this,n=["S\xf8g p\xe5 m\xe6rke, model, farve, udstyr mm...          ","Stationcar anh\xe6ngertr\xe6k...                        ","Hvid varevogn...                                  ","Diesel SUV...                                     "][Math.floor(4*Math.random())],l=0,a=setInterval(function(){if(l===n.length){clearInterval(a),setTimeout(()=>e.PlaceholderShuffler(),400);return}element.attr("placeholder",n.substr(0,l+1)),l++},100)},this.ReloadUserFilterSelection=function(n){t.length>0&&(null!==s&&s.abort(),f(),g(),v(),s=e.ajax({url:ajax_config.restUrl+"autoit-dealer-tools/v1/filteroptions",method:"POST",dataType:"json",data:{action:"get_filter_options",filter:n?null:u},cache:!1,success:function(e){b(e),e.values&&(e.values.companyIds&&e.values.companyIds[0]&&t.find('select[name=company] option[value="'+e.values.companyIds[0]+'"]').prop("selected",!0),e.values.fullTextSearch&&e.values.fullTextSearch[0]&&t.find("input[name=fullTextSearch]").val(e.values.fullTextSearch[0]),e.values.makes&&e.values.makes[0]&&t.find('select[name=make] option[value="'+e.values.makes[0]+'"]').prop("selected",!0),e.values.models&&e.values.models[0]&&t.find('select[name=model] option[value="'+e.values.models[0]+'"]').prop("selected",!0),e.values.propellants&&e.values.propellants[0]&&t.find('select[name=propellant] option[value="'+e.values.propellants[0]+'"]').prop("selected",!0),e.values.bodyTypes&&e.values.bodyTypes[0]&&t.find('select[name=bodyType] option[value="'+e.values.bodyTypes[0]+'"]').prop("selected",!0),e.values.productTypes&&e.values.productTypes[0]&&t.find('select[name=productType] option[value="'+e.values.productTypes[0]+'"]').prop("selected",!0),e.values.vehicleStates&&e.values.vehicleStates[0]&&t.find('select[name=vehicleState] option[value="'+e.values.vehicleStates[0]+'"]').prop("selected",!0),e.values.priceTypes&&e.values.priceTypes[0]&&t.find('select[name=priceType] option[value="'+e.values.priceTypes[0]+'"]').prop("selected",!0))},complete:function(){s=null,h(),T()}}))},this.ResetFilters=function(){let t=document.querySelector("#cvt-selected");return null!==t&&(t.dataset.customVehicleTypeSelected,t.dataset.customVehicleTypeSelected=""),e.ajax({url:ajax_config.restUrl+"autoit-dealer-tools/v1/resetfilteroptions",method:"POST",dataType:"json",data:{action:"reset_filter_options"},cache:!1,success:function(e){b(e)},complete:function(){h()}})},this.ResetFilter=function(){f(),v(),u=null,this.ResetFilters().then(p).done(function(){})},this.ResetFrontpageFilter=function(){f(),v(),u=null,this.ResetFilters()},this.StartVehicleSearch=function(){f(),e.when(p()).then(function(){e("html, body").animate({scrollTop:e(".vehicle-row").offset().top-150},500)})},this.SaveUserFilterSettings=function(){f(),g(),m(),h()},this.CustomVehicleTypeSearch=function(e){u=null,u={CustomVehicleTypes:[e]},m()},this.StartOrderByAndAscDesc=function(){y(),g(),u.OrderBy=""===n.find("select[name=orderBy]").val()?null:n.find("select[name=orderBy]").val(),u.Ascending="asc"===n.find("select[name=ascDesc]").val(),e.ajax({url:ajax_config.restUrl+"autoit-dealer-tools/v1/vehiclesearch/search",method:"POST",dataType:"json",data:{action:"vehicle_search",filter:u},cache:!1,success:function(t){e("#vehicle_search_results").html(t)},complete:function(){T()}})},this.PagingFetchMore=function(){!function t(){y(),document.querySelectorAll(".animate__animated").forEach(e=>{e.classList.remove("animate__animated")});let n=document.querySelector("#paging-button");document.querySelector("#cvt-selected");var l=parseInt(n.dataset.currentPage),a=parseInt(n.dataset.amountOfPages),i=parseInt(n.dataset.limit),s=parseInt(n.dataset.end),c=GetCustomVehicleType();c&&(u.CustomVehicleTypes=[c]),e.ajax({url:ajax_config.restUrl+"autoit-dealer-tools/v1/vehiclesearch/search_paging",method:"POST",dataType:"json",data:{action:"vehicle_search_paging",filter:u,currentPage:l,start:s,limit:i},cache:!1,success:function(e){let t=document.querySelector("#vehicle-row");t.innerHTML+=e,a!==l+1?(n.dataset.currentPage=String(l+1),n.dataset.end=String(s+i)):n.remove()},complete:function(){T()}})}()},this.Init()}function GetCustomVehicleType(){let e=document.querySelector("#cvt-selected");if(null!==e)return e.dataset.customVehicleTypeSelected}function FormatPrice(e,t){return -1===e?e:e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")+(t?",-":"")}jQuery(function(e){var t=new Biltorvet(e);e(document).on("change",".bdtSlider",function(t){var n=t.value.newValue[0],l=t.value.newValue[1];"priceRange"===e(t.target).attr("id")&&(n=FormatPrice(n,!1),l=FormatPrice(l,!0)),-1===n&&(n=""),-1===l&&(l=""),e(this).closest(".bdtSliderContainer").find(".bdtSliderMinVal").text(n).end().find(".bdtSliderMaxVal").text(l)}).on("slideStop",".bdtSlider",function(e){t.ReloadUserFilterSelection(!1)}).on("click",".bdt .reset",function(n){n.preventDefault(),e(this).closest(".bdt .vehicle_search").find("select").val(""),t.ResetFilter()}).on("click",".bdt .resetFrontpage",function(n){n.preventDefault(),e(this).closest(".bdt .vehicle_search").find("select").val(""),t.ResetFrontpageFilter()}).on("click",".bdt .search",function(e){e.preventDefault(),t.StartVehicleSearch()}).on("click","#vehicle_search_frontpage_button",function(e){e.preventDefault(),t.SaveUserFilterSettings()}).on("change",".searchFilter select",function(e){e.preventDefault(),t.StartOrderByAndAscDesc()}).on("click",".bdt .paging-button",function(e){e.preventDefault(),t.PagingFetchMore()}).on("click",".car-icon-container",function(e){e.preventDefault();let n=e.target.closest(".car-icon-container"),l=n.dataset.customVehicleType;l&&t.CustomVehicleTypeSearch(l)}).on("blur",".fullTextSearch",function(){var n=e(this).closest(".bdt .vehicle_search");n.find("select[name=company]").val(""),n.find("select[name=vehicleState]").val(""),n.find("select[name=make]").val(""),n.find("select[name=model]").val(""),n.find("select[name=bodyType]").val(""),n.find("select[name=productType]").val(""),n.find("select[name=priceType]").val(""),n.find("select[name=propellant]").val(""),n.find("select[name=priceMinMax]").val(""),n.find("select[name=priceMinMax]").val(""),n.find("select[name=consumptionMin]").val(""),n.find("select[name=consumptionMax]").val(""),t.ReloadUserFilterSelection(!1)}).on("change",".bdt .vehicle_search select",function(){var n=e(this).closest(".bdt .vehicle_search");let l=document.querySelector("#cvt-selected");null!==l&&(l.dataset.customVehicleTypeSelected=""),"make"===e(this).attr("name")&&n.find("select[name=model]").val("").trigger("change"),"model"===e(this).attr("name")&&(n.find("select[name=bodyType]").val(""),n.find("select[name=productType]").val(""),n.find("select[name=propellant]").val(""),n.find("select[name=priceType]").val(""),n.find("select[name=priceMinMax]").val(""),n.find("select[name=priceMinMax]").val(""),n.find("select[name=consumptionMin]").val(""),n.find("select[name=consumptionMax]").val("")),"vehicleState"===e(this).attr("name")&&(n.find("select[name=make]").val(""),n.find("select[name=model]").val(""),n.find("select[name=bodyType]").val(""),n.find("select[name=productType]").val(""),n.find("select[name=propellant]").val(""),n.find("select[name=priceType]").val(""),n.find("select[name=priceMinMax]").val(""),n.find("select[name=priceMinMax]").val(""),n.find("select[name=consumptionMin]").val(""),n.find("select[name=consumptionMax]").val("")),"company"===e(this).attr("name")&&(n.find("select[name=vehicleState]").val(""),n.find("select[name=make]").val(""),n.find("select[name=model]").val(""),n.find("select[name=bodyType]").val(""),n.find("select[name=productType]").val(""),n.find("select[name=propellant]").val(""),n.find("select[name=priceType]").val(""),n.find("select[name=priceMinMax]").val(""),n.find("select[name=priceMinMax]").val(""),n.find("select[name=consumptionMin]").val(""),n.find("select[name=consumptionMax]").val("")),t.ReloadUserFilterSelection(!1)})});