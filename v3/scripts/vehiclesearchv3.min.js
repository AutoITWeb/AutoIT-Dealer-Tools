function Biltorvet($){var a=$(document).find(".bdt .vehicle_search"),d=$(document).find(".bdt .vehicle_search_results"),b="",c=document.getElementById("frontpage_vehicle_search"),e=document.getElementById("vehicle_search_frontpage_button"),f=null,g=a.find(".lds-ring"),h=null,i=null,j=!1,k={CompanyIds:null,Propellant:null,Makes:null,Models:null,BodyTypes:null,ProductTypes:null,VehicleStates:null,FullTextSearch:null,PriceMin:null,PriceMax:null,ConsumptionMin:null,ConsumptionMax:null,Start:null,Limit:null,OrderBy:null,Ascending:null};function l(){return $.ajax({url:ajax_config.restUrl+"autoit-dealer-tools/v1/vehiclesearch/search",method:"POST",dataType:"json",data:{action:"vehicle_search",filter:k},cache:!1,success:function(a){$("#vehicle_search_results").html(a)},complete:function(){q(),o()}})}function m(){j?(i.bootstrapSlider("disable"),h.bootstrapSlider("disable")):(i.slider("disable"),h.slider("disable")),a.find("select").prop("disabled",!0)}function n(){g.hasClass("d-none")&&g.css("opacity",0).css("display","block").removeClass("d-none"),g.animate({opacity:1},1e3)}function o(){g.animate({opacity:0},200,function(){$(this).css("display","none").addClass("d-none")})}function p(){var a=d.find(".lds-ring-paging");a.hasClass("d-none")&&a.css("opacity",0).css("display","block").removeClass("d-none"),a.animate({opacity:1},1e3)}function q(){d.find(".lds-ring-paging").animate({opacity:0},200,function(){$(this).css("display","none").addClass("d-none")})}function r(b){c?(e.setAttribute("data-labelpattern","Vis "+b.totalResults+" resultater"),e.innerText="Vis "+b.totalResults+" resultater"):a.find(".search").text(a.find(".search").data("labelpattern").replace("%u",b.totalResults));var f="";for(var d in b.fullTextSearch)f+=b.fullTextSearch.value;a.find("input[name=fullTextSearch]").val(f),""!==f&&a.find("input[name=fullTextSearch]").removeAttr("disabled");var g="";for(var d in b.companies)g+='<option value="'+b.companies[d].key+'">'+b.companies[d].value+"</option>";a.find("select[name=company]").find("option:not(:first-child)").remove().end().append(g),""!==g&&a.find("select[name=company]").removeAttr("disabled");var k="";for(var d in b.makes)k+='<option value="'+b.makes[d].name+'">'+b.makes[d].name+"</option>";a.find("select[name=make]").find("option:not(:first-child)").remove().end().append(k),""!==k&&a.find("select[name=make]").removeAttr("disabled");var l="";for(var d in b.models)l+='<option value="'+b.models[d].name+'">'+b.models[d].name+"</option>";a.find("select[name=model]").find("option:not(:first-child)").remove().end().append(l),""!==l&&a.find("select[name=model]").removeAttr("disabled");var m="";for(var d in b.propellants)m+='<option value="'+b.propellants[d].name+'">'+b.propellants[d].name+"</option>";a.find("select[name=propellant]").find("option:not(:first-child)").remove().end().append(m),""!==m&&a.find("select[name=propellant]").removeAttr("disabled");var n="";for(var d in b.bodyTypes)n+='<option value="'+b.bodyTypes[d].name+'">'+b.bodyTypes[d].name+"</option>";a.find("select[name=bodyType]").find("option:not(:first-child)").remove().end().append(n),""!==n&&a.find("select[name=bodyType]").removeAttr("disabled");var o="";for(var d in b.vehicleStates)o+='<option value="'+b.vehicleStates[d].name+'">'+b.vehicleStates[d].name+"</option>";a.find("select[name=vehicleState]").find("option:not(:first-child)").remove().end().append(o),""!==o&&a.find("select[name=vehicleState]").removeAttr("disabled");var p="";for(var d in b.productTypes)p+='<option value="'+b.productTypes[d].name+'">'+b.productTypes[d].name+"</option>";a.find("select[name=productType]").find("option:not(:first-child)").remove().end().append(p),""!==p&&a.find("select[name=productType]").removeAttr("disabled"),null!==i&&(j?i.bootstrapSlider(b.consumptionMin===b.consumptionMax?"disable":"enable"):i.slider(b.consumptionMin===b.consumptionMax?"disable":"enable")).data("slider").setAttribute("min",b.consumptionMin).setAttribute("max",b.consumptionMax).setValue([null===b.values.consumptionMin?b.consumptionMin:b.values.consumptionMin,null===b.values.consumptionMax?b.consumptionMax:b.values.consumptionMax],!0,!0),null!==h&&(j?h.bootstrapSlider(b.priceMin===b.priceMax?"disable":"enable"):h.slider(b.priceMin===b.priceMax?"disable":"enable")).data("slider").setAttribute("min",b.priceMin).setAttribute("max",b.priceMax).setValue([null===b.values.priceMin?b.priceMin:b.values.priceMin,null===b.values.priceMax?b.priceMax:b.values.priceMax],!0,!0)}function s(){var b=h.data("slider").getValue()[0];b=-1===b?null:b;var c=h.data("slider").getValue()[1];c=-1===c?null:c;var e=i.data("slider").getValue()[0];e=-1===e?null:e;var f=i.data("slider").getValue()[1];f=-1===f?null:f,k={CompanyIds:""===a.find("select[name=company]").val()?null:[a.find("select[name=company]").val()],FullTextSearch:""===a.find("input[name=fullTextSearch]").val()?null:[a.find("input[name=fullTextSearch]").val()],Propellants:""===a.find("select[name=propellant]").val()?null:[a.find("select[name=propellant]").val()],Makes:""===a.find("select[name=make]").val()?null:[a.find("select[name=make]").val()],Models:""===a.find("select[name=model]").val()?null:[a.find("select[name=model]").val()],BodyTypes:""===a.find("select[name=bodyType]").val()?null:[a.find("select[name=bodyType]").val()],ProductTypes:""===a.find("select[name=productType]").val()?null:[a.find("select[name=productType]").val()],VehicleStates:""===a.find("select[name=vehicleState]").val()?null:[a.find("select[name=vehicleState]").val()],PriceMin:null!==h&&h.data("slider").getAttribute("min")!==b?b:null,PriceMax:null!==h&&h.data("slider").getAttribute("max")!==c?c:null,ConsumptionMin:null!==i&&i.data("slider").getAttribute("min")!==e?e:null,ConsumptionMax:null!==i&&i.data("slider").getAttribute("max")!==f?f:null,Start:null,Limit:null,OrderBy:""===d.find("select[name=orderBy]").val()?null:d.find("select[name=orderBy]").val(),Ascending:"asc"===d.find("select[name=ascDesc]").val()}}c&&(b=document.getElementById("root_url").textContent),this.Init=function(){if($.bootstrapSlider&&(j=!0),$("#priceRange").length>0){var a={id:$(this).attr("id"),min:0,max:1e7,range:!0,value:[0,1e7],step:1,tooltip:"hide"};h=j?$("#priceRange").bootstrapSlider(a):$("#priceRange").slider(a)}if($("#consumptionRange").length>0){var b={id:$(this).attr("id"),min:0,max:10,range:!0,value:[0,10],step:1,tooltip:"hide"};i=j?$("#consumptionRange").bootstrapSlider(b):$("#consumptionRange").slider(b)}this.ReloadUserFilterSelection(!0),this.PlaceholderShuffler()},this.PlaceholderShuffler=function(){element=a.find("input[name=fullTextSearch]");var b=this,c=["S\xf8g p\xe5 m\xe6rke, model, farve, udstyr mm...          ","Stationcar anh\xe6ngertr\xe6k...                        ","Hvid varevogn...                                  ","Diesel SUV...                                     "][Math.floor(4*Math.random())],d=0,e=setInterval(function(){if(d===c.length){clearInterval(e),setTimeout(()=>b.PlaceholderShuffler(),400);return}element.attr("placeholder",c.substr(0,d+1)),d++},100)},this.ReloadUserFilterSelection=function(b){a.length>0&&(null!==f&&f.abort(),n(),s(),m(),f=$.ajax({url:ajax_config.restUrl+"autoit-dealer-tools/v1/filteroptions",method:"POST",dataType:"json",data:{action:"get_filter_options",filter:b?null:k},cache:!1,success:function(b){r(b),b.values&&(b.values.companyIds&&b.values.companyIds[0]&&a.find('select[name=company] option[value="'+b.values.companyIds[0]+'"]').prop("selected",!0),b.values.fullTextSearch&&b.values.fullTextSearch[0]&&a.find("input[name=fullTextSearch]").val(b.values.fullTextSearch[0]),b.values.makes&&b.values.makes[0]&&a.find('select[name=make] option[value="'+b.values.makes[0]+'"]').prop("selected",!0),b.values.models&&b.values.models[0]&&a.find('select[name=model] option[value="'+b.values.models[0]+'"]').prop("selected",!0),b.values.propellants&&b.values.propellants[0]&&a.find('select[name=propellant] option[value="'+b.values.propellants[0]+'"]').prop("selected",!0),b.values.bodyTypes&&b.values.bodyTypes[0]&&a.find('select[name=bodyType] option[value="'+b.values.bodyTypes[0]+'"]').prop("selected",!0),b.values.productTypes&&b.values.productTypes[0]&&a.find('select[name=productType] option[value="'+b.values.productTypes[0]+'"]').prop("selected",!0),b.values.vehicleStates&&b.values.vehicleStates[0]&&a.find('select[name=vehicleState] option[value="'+b.values.vehicleStates[0]+'"]').prop("selected",!0))},complete:function(){f=null,o(),q()}}))},this.ResetFilters=function(){return $.ajax({url:ajax_config.restUrl+"autoit-dealer-tools/v1/resetfilteroptions",method:"POST",dataType:"json",data:{action:"reset_filter_options"},cache:!1,success:function(a){r(a)},complete:function(){o()}})},this.ResetFilter=function(){n(),m(),k=null,this.ResetFilters().then(l).done(function(){})},this.ResetFrontpageFilter=function(){n(),m(),k=null,this.ResetFilters()},this.StartVehicleSearch=function(){n(),$.when(l()).then(function(){$("html, body").animate({scrollTop:$(".vehicle-row").offset().top-150},500)})},this.SaveUserFilterSettings=function(){n(),s(),n(),$.ajax({url:ajax_config.restUrl+"autoit-dealer-tools/v1/filteroptions/savefilter",method:"POST",dataType:"json",data:{action:"save_filter",filter:k},cache:!1,success:function(a){window.location.href=b+"/"},complete:function(){o()}}),o()},this.StartOrderByAndAscDesc=function(){p(),s(),k.OrderBy=""===d.find("select[name=orderBy]").val()?null:d.find("select[name=orderBy]").val(),k.Ascending="asc"===d.find("select[name=ascDesc]").val(),$.ajax({url:ajax_config.restUrl+"autoit-dealer-tools/v1/vehiclesearch/search",method:"POST",dataType:"json",data:{action:"vehicle_search",filter:k},cache:!1,success:function(a){$("#vehicle_search_results").html(a)},complete:function(){q()}})},this.PagingFetchMore=function(){(function(){p(),document.querySelectorAll(".animate__animated").forEach(a=>{a.classList.remove("animate__animated")});let a=document.querySelector("#paging-button");var b=parseInt(a.dataset.currentPage),e=parseInt(a.dataset.amountOfPages),c=parseInt(a.dataset.limit),d=parseInt(a.dataset.end);$.ajax({url:ajax_config.restUrl+"autoit-dealer-tools/v1/vehiclesearch/search_paging",method:"POST",dataType:"json",data:{action:"vehicle_search_paging",filter:k,currentPage:b,start:d,limit:c},cache:!1,success:function(f){let g=document.querySelector("#vehicle-row");g.innerHTML+=f,e!==b+1?(a.dataset.currentPage=String(b+1),a.dataset.end=String(d+c)):a.remove()},complete:function(){q()}})})()},this.Init()}function FormatPrice(a,b){return -1===a?a:a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")+(b?",-":"")}jQuery(function($){var a=new Biltorvet($);$(document).on("change",".bdtSlider",function(c){var a=c.value.newValue[0],b=c.value.newValue[1];"priceRange"===$(c.target).attr("id")&&(a=FormatPrice(a,!1),b=FormatPrice(b,!0)),-1===a&&(a=""),-1===b&&(b=""),$(this).closest(".bdtSliderContainer").find(".bdtSliderMinVal").text(a).end().find(".bdtSliderMaxVal").text(b)}).on("slideStop",".bdtSlider",function(b){a.ReloadUserFilterSelection(!1)}).on("click",".bdt .reset",function(b){b.preventDefault(),$(this).closest(".bdt .vehicle_search").find("select").val(""),a.ResetFilter()}).on("click",".bdt .resetFrontpage",function(b){b.preventDefault(),$(this).closest(".bdt .vehicle_search").find("select").val(""),a.ResetFrontpageFilter()}).on("click",".bdt .search",function(b){b.preventDefault(),a.StartVehicleSearch()}).on("click","#vehicle_search_frontpage_button",function(b){b.preventDefault(),a.SaveUserFilterSettings()}).on("change",".searchFilter select",function(b){b.preventDefault(),a.StartOrderByAndAscDesc()}).on("click",".bdt .paging-button",function(b){b.preventDefault(),a.PagingFetchMore()}).on("blur",".fullTextSearch",function(){var b=$(this).closest(".bdt .vehicle_search");b.find("select[name=company]").val(""),b.find("select[name=vehicleState]").val(""),b.find("select[name=make]").val(""),b.find("select[name=model]").val(""),b.find("select[name=bodyType]").val(""),b.find("select[name=productType]").val(""),b.find("select[name=propellant]").val(""),b.find("select[name=priceMinMax]").val(""),b.find("select[name=priceMinMax]").val(""),b.find("select[name=consumptionMin]").val(""),b.find("select[name=consumptionMax]").val(""),a.ReloadUserFilterSelection(!1)}).on("change",".bdt .vehicle_search select",function(){var b=$(this).closest(".bdt .vehicle_search");"make"===$(this).attr("name")&&b.find("select[name=model]").val("").trigger("change"),"model"===$(this).attr("name")&&(b.find("select[name=bodyType]").val(""),b.find("select[name=productType]").val(""),b.find("select[name=propellant]").val(""),b.find("select[name=priceMinMax]").val(""),b.find("select[name=priceMinMax]").val(""),b.find("select[name=consumptionMin]").val(""),b.find("select[name=consumptionMax]").val("")),"vehicleState"===$(this).attr("name")&&(b.find("select[name=make]").val(""),b.find("select[name=model]").val(""),b.find("select[name=bodyType]").val(""),b.find("select[name=productType]").val(""),b.find("select[name=propellant]").val(""),b.find("select[name=priceMinMax]").val(""),b.find("select[name=priceMinMax]").val(""),b.find("select[name=consumptionMin]").val(""),b.find("select[name=consumptionMax]").val("")),"company"===$(this).attr("name")&&(b.find("select[name=vehicleState]").val(""),b.find("select[name=make]").val(""),b.find("select[name=model]").val(""),b.find("select[name=bodyType]").val(""),b.find("select[name=productType]").val(""),b.find("select[name=propellant]").val(""),b.find("select[name=priceMinMax]").val(""),b.find("select[name=priceMinMax]").val(""),b.find("select[name=consumptionMin]").val(""),b.find("select[name=consumptionMax]").val("")),a.ReloadUserFilterSelection(!1)})})