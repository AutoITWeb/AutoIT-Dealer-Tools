function Biltorvet(e){var t=e(document).find(".bdt .vehicle_search"),n=e(document).find(".bdt .vehicle_search_results"),l="",a=document.getElementById("bdt-loading-filters"),i=document.getElementById("frontpage_vehicle_search"),s=document.getElementById("vehicle_search_frontpage_button"),r=null,c=t.find(".lds-ring"),o=null,d=null,u=!1,p=document.getElementById("LeasingAlternativeName"),m={CompanyIds:null,Propellant:null,Makes:null,Models:null,BodyTypes:null,ProductTypes:null,VehicleStates:null,FullTextSearch:null,PriceTypes:null,CustomVehicleTypes:null,PriceMin:null,PriceMax:null,ConsumptionMin:null,ConsumptionMax:null,Start:null,Limit:null,OrderBy:null,Ascending:null};function f(t){var n=e(t).next(".select2-container").find(".select2-selection__rendered");e(n).parent().find(".select2-search__field").show(),e(n).parent().find(".select2-selection__label").remove(),e(t).parent().find(".selectDropDownLabel").show()}function v(t){if(e(t).hasClass("select2-hidden-accessible")){let n=[];return e(t).select2("data").forEach(e=>{let t={val:e.id};n.push(t.val)}),n}}function h(t,n){e(t).trigger("change.select2");var l=e(t).next(".select2-container").find(".select2-selection__rendered"),a=e(l).children("li");e(l).show(),e(l).parent().find(".select2-selection__label").remove();var i=e(l).width(),s=-20;a.length?(e(l).parent().find(".select2-search__field").hide(),e(t).parent().find(".selectDropDownLabel").hide()):(e(l).parent().find(".select2-search__field").show(),e(t).parent().find(".selectDropDownLabel").show()),e(a).each(function(){s+=a.outerWidth()}),s>i?(e(l).hide(),e(l).parent().append('<span class="select2-selection__label">'+a.length+" valgte "+e(t).data("contenttype")+"</span>")):(e(l).show(),e(l).parent().find(".select2-selection__label").remove())}function y(t,n,l){l.forEach(l=>{let a={text:l.name??l.value,value:l.key??l.name},i=!1;null!==n&&0!==n.length&&n.includes(l)&&(i=!0);var s=new Option(a.text,a.value,!1,i);e(t).find("option[value='"+a.value+"']").length||e(t).append(s).trigger("change.select2")})}function g(){u?(d.bootstrapSlider("disable"),o.bootstrapSlider("disable")):(d.slider("disable"),o.slider("disable")),t.find("select").prop("disabled",!0);var e=document.getElementsByClassName("car-icon-container");e.length>0&&Array.from(e).forEach(function(e){e.classList.add("cvt-disable-clicking")})}function b(){c.hasClass("d-none")&&c.css("opacity",0).css("display","block").removeClass("d-none"),c.animate({opacity:1},1e3)}function T(){c.animate({opacity:0},200,function(){e(this).css("display","none").addClass("d-none")})}function $(){var t=e(document).find(".bdt .vehicle_search_results").find(".lds-ring-paging");t.hasClass("d-none")&&t.css("opacity",0).css("display","block").removeClass("d-none"),t.animate({opacity:1},1e3)}function S(){var t=e(document).find(".bdt .vehicle_search_results").find(".lds-ring-paging");p&&e('#select-orderby option:contains("Leasingpris")').text(p.innerText),t.animate({opacity:0},200,function(){e(this).css("display","none").addClass("d-none")})}function x(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")}function M(e){for(var t="1",n=1;n<(""+e).length;n++)t+="0";return parseInt(t)}function _(e,n){var l,a=t.find("select[name="+e+"]")[0].options;let i=[...a].map(e=>e.value);((l=i).filter((e,t)=>l.indexOf(e)!=t).length>0||n.length!==i.length)&&document.getElementById(e).options[0].remove()}function k(e){i?(s.setAttribute("data-labelpattern","Vis "+e.totalResults+" resultater"),s.innerText="Vis "+e.totalResults+" resultater"):t.find(".search").text(t.find(".search").data("labelpattern").replace("%u",e.totalResults));var n="";for(var l in e.fullTextSearch)n+=e.fullTextSearch.value;t.find("input[name=fullTextSearch]").val(n),""!==n&&t.find("input[name=fullTextSearch]").removeAttr("disabled");var a="";for(var l in e.companies)a+='<option value="'+e.companies[l].key+'">'+e.companies[l].value+"</option>";t.find("select[name=company]").find("option:not(:first-child)").remove().end().append(a),_("company",e.companies),""!==a&&t.find("select[name=company]").removeAttr("disabled");var r="";for(var l in e.makes)r+='<option value="'+e.makes[l].name+'">'+e.makes[l].name+"</option>";t.find("select[name=make]").find("option:not(:first-child)").remove().end().append(r),_("make",e.makes),""!==r&&t.find("select[name=make]").removeAttr("disabled");var c="";for(var l in e.models)c+='<option value="'+e.models[l].name+'">'+e.models[l].name+"</option>";t.find("select[name=model]").find("option:not(:first-child)").remove().end().append(c),_("model",e.models),""!==c&&t.find("select[name=model]").removeAttr("disabled");var m="";for(var l in e.vehicleStates)m+='<option value="'+e.vehicleStates[l].name+'">'+e.vehicleStates[l].name+"</option>";t.find("select[name=vehicleState]").find("option:not(:first-child)").remove().end().append(m),_("vehicleState",e.vehicleStates),""!==m&&t.find("select[name=vehicleState]").removeAttr("disabled");var f="";for(var l in e.priceTypes)p&&"Leasing"==e.priceTypes[l].name?f+='<option value="'+e.priceTypes[l].name+'">'+p.innerText+"</option>":f+='<option value="'+e.priceTypes[l].name+'">'+e.priceTypes[l].name+"</option>";t.find("select[name=priceType]").find("option:not(:first-child)").remove().end().append(f),_("priceType",e.priceTypes),""!==f&&t.find("select[name=priceType]").removeAttr("disabled");var v="";for(var l in e.productTypes)v+='<option value="'+e.productTypes[l].name+'">'+e.productTypes[l].name+"</option>";t.find("select[name=productType]").find("option:not(:first-child)").remove().end().append(v),_("productType",e.productTypes),""!==v&&t.find("select[name=productType]").removeAttr("disabled");var h="";for(var l in e.bodyTypes)h+='<option value="'+e.bodyTypes[l].name+'">'+e.bodyTypes[l].name+"</option>";t.find("select[name=bodyType]").find("option:not(:first-child)").remove().end().append(h),_("bodyType",e.bodyTypes),""!==h&&t.find("select[name=bodyType]").removeAttr("disabled");var y="";for(var l in e.propellants)y+='<option value="'+e.propellants[l].name+'">'+e.propellants[l].name+"</option>";t.find("select[name=propellant]").find("option:not(:first-child)").remove().end().append(y),_("propellant",e.propellants),""!==y&&t.find("select[name=propellant]").removeAttr("disabled"),null!==d&&(u?d.bootstrapSlider(e.consumptionMin===e.consumptionMax?"disable":"enable"):d.slider(e.consumptionMin===e.consumptionMax?"disable":"enable")).data("slider").setAttribute("min",e.consumptionMin).setAttribute("max",e.consumptionMax).setValue([null===e.values.consumptionMin?e.consumptionMin:e.values.consumptionMin,null===e.values.consumptionMax?e.consumptionMax:e.values.consumptionMax],!0,!0),null!==o&&(u?o.bootstrapSlider(e.priceMin===e.priceMax?"disable":"enable"):o.slider(e.priceMin===e.priceMax?"disable":"enable")).data("slider").setAttribute("min",e.priceMin).setAttribute("max",e.priceMax).setValue([null===e.values.priceMin?e.priceMin:e.values.priceMin,null===e.values.priceMax?e.priceMax:e.values.priceMax],!0,!0);var g=document.getElementsByClassName("car-icon-container");g.length>0&&Array.from(g).forEach(function(e){e.classList.remove("cvt-disable-clicking")})}function V(){var e=o.data("slider").getValue()[0];e=-1===e?null:e;var l=o.data("slider").getValue()[1];l=-1===l?null:l;var a=d.data("slider").getValue()[0];a=-1===a?null:a;var i=d.data("slider").getValue()[1];i=-1===i?null:i,m={CompanyIds:v("#company")??null,FullTextSearch:""===t.find("input[name=fullTextSearch]").val()?null:[t.find("input[name=fullTextSearch]").val()],Propellants:v("#propellant")??null,Makes:v("#make")??null,Models:v("#model")??null,BodyTypes:v("#bodyType")??null,ProductTypes:v("#productType")??null,VehicleStates:v("#vehicleState")??null,PriceTypes:v("#priceType")??null,PriceMin:null!==o&&o.data("slider").getAttribute("min")!==e?e:null,PriceMax:null!==o&&o.data("slider").getAttribute("max")!==l?l:null,ConsumptionMin:null!==d&&d.data("slider").getAttribute("min")!==a?a:null,ConsumptionMax:null!==d&&d.data("slider").getAttribute("max")!==i?i:null,Start:null,Limit:null,OrderBy:""===n.find("select[name=orderBy]").val()?null:n.find("select[name=orderBy]").val(),Ascending:"asc"===n.find("select[name=ascDesc]").val()};var s=GetCustomVehicleType();s&&(m.CustomVehicleTypes=[s])}e(document).ready(function(t){e(".multiple").select2({dropdownParent:e(".vehicle_search"),containerCssClass:".multiple"});var n="";e(".quicksearch").select2({ajax:{url:ajax_config.restUrl+"autoit-dealer-tools/v1/vehiclesearch/quicksearch",method:"POST",dataType:"json",delay:250,data:function(e){return n=e.term,{action:"vehicle_quicksearch",q:[e.term]}},processResults:function(e){return{results:e.vehicles}},cache:!0},minimumInputLength:2,placeholder:"S\xf8g efter k\xf8ret\xf8jer...",language:{noResults:function(){return"S\xf8gningen '"+n+"' gav ingen resultater."},inputTooShort:function(e){return"Indtast "+e.minimum+" eller flere tegn for at starte din s\xf8gning"},inputTooLong:function(e){return"Du har indtastet for mange tegn. "+e.maximum+" er maks antal tegn der kan indtastes"},errorLoading:function(){return"Der er desv\xe6rre sket en fejl - pr\xf8v venligst igen"},searching:function(){return"S\xf8ger..."}},escapeMarkup:function(e){return e},templateResult:Vehicles,templateSelection:VehiclesSelection})}),i&&(l=document.getElementById("root_url").textContent),this.Init=function(){if(e.bootstrapSlider&&(u=!0),e("#priceRange").length>0){var t={id:e(this).attr("id"),min:0,max:1e7,range:!0,value:[0,1e7],step:1,tooltip:"hide"};o=u?e("#priceRange").bootstrapSlider(t):e("#priceRange").slider(t)}if(e("#consumptionRange").length>0){var n={id:e(this).attr("id"),min:0,max:10,range:!0,value:[0,10],step:1,tooltip:"hide"};d=u?e("#consumptionRange").bootstrapSlider(n):e("#consumptionRange").slider(n)}this.ReloadUserFilterSelection(!0),this.VehicleSearch(!0),this.PlaceholderShuffler()},this.PlaceholderShuffler=function(){fullTextSearch=t.find("input[name=fullTextSearch]");var n=this,l=["S\xf8g p\xe5 m\xe6rke, model, farve, udstyr mm...          ","S\xf8g p\xe5 stationcar anh\xe6ngertr\xe6k...                        ","S\xf8g p\xe5 hvid varevogn...                                  ","S\xf8g p\xe5 diesel SUV...                                     "][Math.floor(4*Math.random())],a=0,i=setInterval(function(){if(a===l.length){clearInterval(i),setTimeout(()=>n.PlaceholderShuffler(),400);return}e(".select2-search__field").attr("placeholder",l.substr(0,a+1)),fullTextSearch.attr("placeholder",l.substr(0,a+1)),a++},100)},this.ReloadUserFilterSelection=function(n){t.length>0&&(null!==r&&r.abort(),b(),V(),g(),r=e.ajax({url:ajax_config.restUrl+"autoit-dealer-tools/v1/filteroptions",method:"POST",dataType:"json",data:{action:"get_filter_options",filter:n?null:m},cache:!1,success:function(n){if(k(n),n.values&&(n.values.companyIds&&n.values.companyIds[0]?(e("#company").val(n.values.companyIds),h(e("#company"))):f("#company"),n.values.fullTextSearch&&n.values.fullTextSearch[0]&&t.find("input[name=fullTextSearch]").val(n.values.fullTextSearch[0]),n.values.makes&&n.values.makes[0]?(e("#make").val(n.values.makes),h(e("#make"))):f("#make"),n.values.models&&n.values.models[0]?(e("#model").val(n.values.models),h(e("#model"))):f("#model"),n.values.propellants&&n.values.propellants[0]?(e("#propellant").val(n.values.propellants),h(e("#propellant"))):f("#propellant"),n.values.bodyTypes&&n.values.bodyTypes[0]?(e("#bodyType").val(n.values.bodyTypes),h(e("#bodyType"))):f("#bodyType"),n.values.productTypes&&n.values.productTypes[0]?(e("#productType").val(n.values.productTypes),h(e("#productType"))):f("#productType"),n.values.vehicleStates&&n.values.vehicleStates[0]?(e("#vehicleState").val(n.values.vehicleStates),h(e("#vehicleState"))):f("#vehicleState"),n.values.priceTypes&&n.values.priceTypes[0]?(e("#priceType").val(n.values.priceTypes),h(e("#priceType"))):f("#priceType"),n.values.customVehicleTypes&&n.values.customVehicleTypes[0])){var l=document.getElementsByClassName("car-icon-container");l.length>0&&Array.from(l).forEach(function(t){if(n.values.customVehicleTypes[0]===t.dataset.customVehicleType){let l="cvt-checkmark-"+t.dataset.customVehicleType,a=e('[name="'+l+'"]');a[0].style.display="",t.classList.add("cvt-selected")}})}},complete:function(){r=null,T(),S(),a.classList.remove("hide-bdt");let t=new URLSearchParams(window.location.search);if(t.has("scroll")&&"true"===t.get("scroll")){e("html, body").animate({scrollTop:e(".vehicle-row").offset().top-150},500);var n=location.href;window.history.pushState({},"",n.replace("?scroll=true",""))}}}))},this.ResetFilters=function(){return e.ajax({url:ajax_config.restUrl+"autoit-dealer-tools/v1/resetfilteroptions",method:"POST",dataType:"json",data:{action:"reset_filter_options"},cache:!1,success:function(t){k(t),e(".multiple").each(function(t,n){var l=e(n).next(".select2-container").find(".select2-selection__rendered");e(l).parent().find(".select2-selection__label").remove(),e(n).parent().find(".selectDropDownLabel").show()})},complete:function(){T()}})},this.ResetFilter=function(){b(),g(),m=null;let t=document.querySelector(".cvt-selected");if(null!==t){let n=t.dataset.customVehicleType,l=e('[name="cvt-checkmark-'+n+'"]');l[0].style.display="none",t.classList.remove("cvt-selected")}this.ResetFilters()},this.StartVehicleSearch=function(){b(),e.when(this.VehicleSearch()).then(function(){e("html, body").animate({scrollTop:e(".vehicle-row").offset().top-150},500)})},this.VehicleSearch=function(t){return e.ajax({url:ajax_config.restUrl+"autoit-dealer-tools/v1/vehiclesearch/search",method:"POST",dataType:"json",data:{action:"vehicle_search",filter:t?null:m},cache:!1,success:function(t){e("#bdt_vehicle_search_results").html(t)},complete:function(){S(),T()}})},this.SaveUserFilterSettings=function(){b(),V(),b(),e.ajax({url:ajax_config.restUrl+"autoit-dealer-tools/v1/filteroptions/savefilter",method:"POST",dataType:"json",data:{action:"save_filter",filter:m},cache:!1,success:function(e){window.location.href=l+"/?scroll=true"},complete:function(){T()}}),T()},this.StartOrderByAndAscDesc=function(){$(),V(),m.OrderBy=null===e("#select-orderby").val()?null:e("#select-orderby").val(),m.Ascending="asc"===e("#select-asc-desc").val(),e.ajax({url:ajax_config.restUrl+"autoit-dealer-tools/v1/vehiclesearch/search",method:"POST",dataType:"json",data:{action:"vehicle_search",filter:m},cache:!1,success:function(t){e("#vehicle_search_results").html(t)},complete:function(){S()}})},this.PagingFetchMore=function(){!function t(){$(),document.querySelectorAll(".animate__animated").forEach(e=>{e.classList.remove("animate__animated")});let n=document.querySelector("#paging-button");document.querySelector("#cvt-selected");var l=parseInt(n.dataset.currentPage),a=parseInt(n.dataset.amountOfPages),i=parseInt(n.dataset.limit),s=parseInt(n.dataset.end),r=GetCustomVehicleType();r&&(m.CustomVehicleTypes=[r]),e.ajax({url:ajax_config.restUrl+"autoit-dealer-tools/v1/vehiclesearch/search_paging",method:"POST",dataType:"json",data:{action:"vehicle_search_paging",filter:m,currentPage:l,start:s,limit:i},cache:!1,success:function(e){let t=document.querySelector("#vehicle-row");t.innerHTML+=e,a!==l+1?(n.dataset.currentPage=String(l+1),n.dataset.end=String(s+i)):n.remove()},complete:function(){S()}})}()},this.Init()}function GetCustomVehicleType(){let e=document.querySelector(".cvt-selected");if(null!==e)return e.dataset.customVehicleType}function FormatPrice(e,t){return -1===e?e:e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")+(t?",-":"")}function Vehicles(e){if(e.loading)return"S\xf8ger...";var t=null!==e.cashPrice?"Kontantpris "+e.cashPrice:null!==e.leasingPrice?"Leasingpris "+e.leasingPrice:null!==e.financePrice?"Finansieringspris "+e.financePrice:"Ring for pris",n=e.variant;return n.length>30&&(n=n.slice(0,27)+"..."),("<div class='bdt_intellisense-list'><a href='"+e.uri+"'><span class='bdt_intellisense-list-image'><img src='"+e.vehicleImage+"' width='110px' alt='"+e.makeName+"'/></span><span class='bdt_intellisense-list-data'><span class='bdt_intellisense-list-name'>"+e.makeName+" "+e.model+"<br/><span>"+n+"</span></span><span class='bdt_intellisense-list-price'>"+t)??"</span></span></span></a></div>"}function VehiclesSelection(e){return e.makeModelVariant}jQuery(function(e){var t=new Biltorvet(e);function n(){var t=e(this).closest(".bdt .vehicle_search");t.find("select[name=company]").val(""),t.find("select[name=vehicleState]").val(""),t.find("select[name=make]").val(""),t.find("select[name=model]").val(""),t.find("select[name=bodyType]").val(""),t.find("select[name=productType]").val(""),t.find("select[name=priceType]").val(""),t.find("select[name=propellant]").val(""),t.find("select[name=priceMinMax]").val(""),t.find("select[name=priceMinMax]").val(""),t.find("select[name=consumptionMin]").val(""),t.find("select[name=consumptionMax]").val(""),e(".multiple").each(function(t,n){var l=e(n).next(".select2-container").find(".select2-selection__rendered");e(l).parent().find(".select2-selection__label").remove(),e(n).parent().find(".selectDropDownLabel").show()})}e(document).on("change",".bdtSlider",function(t){var n=t.value.newValue[0],l=t.value.newValue[1];"priceRange"===e(t.target).attr("id")&&(n=FormatPrice(n,!1),l=FormatPrice(l,!0)),-1===n&&(n=""),-1===l&&(l=""),e(this).closest(".bdtSliderContainer").find(".bdtSliderMinVal").text(n).end().find(".bdtSliderMaxVal").text(l)}).on("slideStop",".bdtSlider",function(e){t.ReloadUserFilterSelection(!1)}).on("click",".bdt .reset",function(e){e.preventDefault(),t.ResetFilter()}).on("change",".bdt .multiple",function(n){n.preventDefault();var l=e(n.target).next(".select2-container").find(".select2-selection__rendered"),a=e(l).children("li");a.length>1&&(a[a.length-1].style.display="none"),a.length?(e(l).parent().find(".select2-search__field").hide(),e(n.target).parent().find(".selectDropDownLabel").hide()):(e(l).parent().find(".select2-search__field").show(),e(n.target).parent().find(".selectDropDownLabel").show()),t.ReloadUserFilterSelection(!1)}).on("click",".bdt .search",function(e){e.preventDefault(),t.StartVehicleSearch()}).on("click","#vehicle_search_frontpage_button",function(e){e.preventDefault(),t.SaveUserFilterSettings()}).on("change",".searchFilter select",function(e){e.preventDefault(),t.StartOrderByAndAscDesc()}).on("click",".bdt .paging-button",function(e){e.preventDefault(),t.PagingFetchMore()}).on("click",".bdt .car-icon-container",function(n){n.preventDefault();let l=n.target.closest(".car-icon-container"),a=l.dataset.customVehicleType,i=e('[name="cvt-checkmark-'+a+'"]'),s=l.classList;if(s.value.includes("cvt-selected"))i[0].style.display="none",l.classList.remove("cvt-selected");else{let r=document.getElementsByClassName("cvt-selected");if(r.length>0){let c=r[0].dataset.customVehicleType,o=e('[name="cvt-checkmark-'+c+'"]');o[0].style.display="none",r[0].classList.remove("cvt-selected")}i[0].style.display="",l.classList.add("cvt-selected")}var d=e(this).closest(".bdt .vehicle_search");d.find("input[name=fullTextSearch]").val(""),d.find("select[name=company]").val(""),d.find("select[name=vehicleState]").val(""),d.find("select[name=make]").val(""),d.find("select[name=model]").val(""),d.find("select[name=bodyType]").val(""),d.find("select[name=productType]").val(""),d.find("select[name=priceType]").val(""),d.find("select[name=propellant]").val(""),d.find("select[name=priceMinMax]").val(""),d.find("select[name=priceMinMax]").val(""),d.find("select[name=consumptionMin]").val(""),d.find("select[name=consumptionMax]").val(""),t.ReloadUserFilterSelection(!1)}).on("blur",".fullTextSearch",function(){t.ReloadUserFilterSelection(!1)}),e(document).ready(function(){let n=e(".paging-button-scroll")[0],l=null;function a(){t.PagingFetchMore()}function i(e){e.forEach(e=>{e.isIntersecting&&a()})}function s(){let t=e(".paging-button-scroll")[0];t!==n&&(l&&(l.disconnect(),l=null),(n=t)&&(l=new IntersectionObserver(i,{threshold:.5})).observe(n))}s(),e(window).on("scroll",s),e(n).on("click",a)})});