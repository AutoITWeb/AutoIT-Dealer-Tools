function Biltorvet(e){var n=e(document).find(".bdt .vehicle_search"),l=e(document).find(".bdt .vehicle_search_results"),t="",a=document.getElementById("frontpage_vehicle_search"),i=document.getElementById("vehicle_search_frontpage_button"),s=null,o=n.find(".lds-ring"),r=null,c=null,d=!1,u={CompanyIds:null,Propellant:null,Makes:null,Models:null,BodyTypes:null,ProductTypes:null,VehicleStates:null,FullTextSearch:null,PriceMin:null,PriceMax:null,ConsumptionMin:null,ConsumptionMax:null,Start:null,Limit:null,OrderBy:null,Ascending:null,BrandNew:null};function p(){v(),e.ajax({url:ajax_config.restUrl+"autoit-dealer-tools/v1/filteroptions/savefilter",method:"POST",dataType:"json",data:{action:"save_filter",filter:u},cache:!1,success:function(e){!function(e,n){var l=window.location.pathname,t=l,a=l.split("/");for(var i in e)if(null!=e[i]){var s=e[i];Array.isArray(e[i])&&(s=e[i].shift()),t=m(a,i,s)}window.history.pushState(null,null,t.replace("+","%2B")),n()}(u,function(){window.location.reload()})},complete:function(){f()}})}function m(e,n,l){var i="";switch(n){case"Makes":e[3]="Maerke",e[4]=l;break;case"Propellants":e[3]="Braendstof",e[4]=l,e[5]="";break;case"BodyTypes":e[3]="Karrosseri",e[4]=l,e[5]="";break;case"CompanyIds":e[3]="Afdeling",e[4]=l,e[5]="";break;case"VehicleStates":e[3]="Stand",e[4]=l,e[5]="";break;case"ProductTypes":e[3]="Type",e[4]=l,e[5]="";break;case"Models":e[5]=l}""===e[2]?e[2]=1:""!==e[2]&&(e[2]="1"),a&&(e[1]=t,e[2]=null==e[3]?"1/":"1");for(var s=1;s<e.length;s++)null!==e[s]&&(i+="/"+e[s]);return a&&(i=i.substr(1)),i}function v(){o.hasClass("d-none")&&o.css("opacity",0).css("display","block").removeClass("d-none"),o.animate({opacity:1},1e3)}function f(){o.animate({opacity:0},200,function(){e(this).css("display","none").addClass("d-none")})}function h(){var e=r.data("slider").getValue()[0];e=-1===e?null:e;var t=r.data("slider").getValue()[1];t=-1===t?null:t;var a=c.data("slider").getValue()[0];a=-1===a?null:a;var i=c.data("slider").getValue()[1];i=-1===i?null:i,u={CompanyIds:""===n.find("select[name=company]").val()?null:[n.find("select[name=company]").val()],FullTextSearch:""===n.find("input[name=fullTextSearch]").val()?null:[n.find("input[name=fullTextSearch]").val()],Propellants:""===n.find("select[name=propellant]").val()?null:[n.find("select[name=propellant]").val()],Makes:""===n.find("select[name=make]").val()?null:[n.find("select[name=make]").val()],Models:""===n.find("select[name=model]").val()?null:[n.find("select[name=model]").val()],BodyTypes:""===n.find("select[name=bodyType]").val()?null:[n.find("select[name=bodyType]").val()],ProductTypes:""===n.find("select[name=productType]").val()?null:[n.find("select[name=productType]").val()],VehicleStates:""===n.find("select[name=vehicleState]").val()?null:[n.find("select[name=vehicleState]").val()],PriceMin:null!==r&&r.data("slider").getAttribute("min")!==e?e:null,PriceMax:null!==r&&r.data("slider").getAttribute("max")!==t?t:null,ConsumptionMin:null!==c&&c.data("slider").getAttribute("min")!==a?a:null,ConsumptionMax:null!==c&&c.data("slider").getAttribute("max")!==i?i:null,Start:null,Limit:null,OrderBy:""===l.find("select[name=orderBy]").val()?null:l.find("select[name=orderBy]").val(),Ascending:"asc"===l.find("select[name=ascDesc]").val(),BrandNew:null}}a&&(t=document.getElementById("root_url").textContent),this.Init=function(){if(e.bootstrapSlider&&(d=!0),e("#priceRange").length>0){var n={id:e(this).attr("id"),min:100,max:1e7,range:!0,value:[1e3,1e7],step:1,tooltip:"hide"};r=d?e("#priceRange").bootstrapSlider(n):e("#priceRange").slider(n)}if(e("#consumptionRange").length>0){var l={id:e(this).attr("id"),min:0,max:10,range:!0,value:[0,10],step:1,tooltip:"hide"};c=d?e("#consumptionRange").bootstrapSlider(l):e("#consumptionRange").slider(l)}this.ReloadUserFilterSelection(!0),this.PlaceholderShuffler()},this.PlaceholderShuffler=function(){element=n.find("input[name=fullTextSearch]");var e=this,l=["Søg på mærke, model, farve, udstyr mm...          ","Stationcar anhængertræk...                        ","Hvid varevogn...                                  ","Diesel SUV...                                     "][Math.floor(4*Math.random())],t=0,a=setInterval(function(){if(t===l.length)return clearInterval(a),void setTimeout(()=>e.PlaceholderShuffler(),400);element.attr("placeholder",l.substr(0,t+1)),t++},100)},this.ReloadUserFilterSelection=function(l){n.length>0&&(null!==s&&s.abort(),v(),h(),function(){d?(c.bootstrapSlider("disable"),r.bootstrapSlider("disable")):(c.slider("disable"),r.slider("disable"));n.find("select").prop("disabled",!0)}(),s=e.ajax({url:ajax_config.restUrl+"autoit-dealer-tools/v1/filteroptions",method:"POST",dataType:"json",data:{action:"get_filter_options",filter:l?null:u},cache:!1,success:function(e){var l="";for(var t in e.fullTextSearch)l+=e.fullTextSearch.value;n.find("input[name=fullTextSearch]").val(l),""!==l&&n.find("input[name=fullTextSearch]").removeAttr("disabled");var s="";for(var t in e.companies)s+='<option value="'+e.companies[t].key+'">'+e.companies[t].value+"</option>";n.find("select[name=company]").find("option:not(:first-child)").remove().end().append(s),""!==s&&n.find("select[name=company]").removeAttr("disabled");var o="";for(var t in e.makes)o+='<option value="'+e.makes[t].name+'">'+e.makes[t].name+"</option>";n.find("select[name=make]").find("option:not(:first-child)").remove().end().append(o),""!==o&&n.find("select[name=make]").removeAttr("disabled");var u="";for(var t in e.models)u+='<option value="'+e.models[t].name+'">'+e.models[t].name+"</option>";n.find("select[name=model]").find("option:not(:first-child)").remove().end().append(u),""!==u&&n.find("select[name=model]").removeAttr("disabled");var p="";for(var t in e.propellants)p+='<option value="'+e.propellants[t].name+'">'+e.propellants[t].name+"</option>";n.find("select[name=propellant]").find("option:not(:first-child)").remove().end().append(p),""!==p&&n.find("select[name=propellant]").removeAttr("disabled");var m="";for(var t in e.bodyTypes)m+='<option value="'+e.bodyTypes[t].name+'">'+e.bodyTypes[t].name+"</option>";n.find("select[name=bodyType]").find("option:not(:first-child)").remove().end().append(m),""!==m&&n.find("select[name=bodyType]").removeAttr("disabled");var v="";for(var t in e.vehicleStates)v+='<option value="'+e.vehicleStates[t].name+'">'+e.vehicleStates[t].name+"</option>";n.find("select[name=vehicleState]").find("option:not(:first-child)").remove().end().append(v),""!==v&&n.find("select[name=vehicleState]").removeAttr("disabled");var f="";for(var t in e.productTypes)f+='<option value="'+e.productTypes[t].name+'">'+e.productTypes[t].name+"</option>";(n.find("select[name=productType]").find("option:not(:first-child)").remove().end().append(f),""!==f&&n.find("select[name=productType]").removeAttr("disabled"),a?(i.setAttribute("data-labelpattern","Vis "+e.totalResults+" resultater"),i.innerText="Vis "+e.totalResults+" resultater"):n.find(".search").text(n.find(".search").data("labelpattern").replace("%u",e.totalResults)),null!==c)&&(d?c.bootstrapSlider(e.consumptionMin===e.consumptionMax?"disable":"enable"):c.slider(e.consumptionMin===e.consumptionMax?"disable":"enable")).data("slider").setAttribute("min",e.consumptionMin).setAttribute("max",e.consumptionMax).setValue([null===e.values.consumptionMin?e.consumptionMin:e.values.consumptionMin,null===e.values.consumptionMax?e.consumptionMax:e.values.consumptionMax],!0,!0);null!==r&&(d?r.bootstrapSlider(e.priceMin===e.priceMax?"disable":"enable"):r.slider(e.priceMin===e.priceMax?"disable":"enable")).data("slider").setAttribute("min",e.priceMin).setAttribute("max",e.priceMax).setValue([null===e.values.priceMin?e.priceMin:e.values.priceMin,null===e.values.priceMax?e.priceMax:e.values.priceMax],!0,!0);e.values&&(e.values.companyIds&&e.values.companyIds[0]&&n.find('select[name=company] option[value="'+e.values.companyIds[0]+'"]').prop("selected",!0),e.values.fullTextSearch&&e.values.fullTextSearch[0]&&n.find("input[name=fullTextSearch]").val(e.values.fullTextSearch[0]),e.values.makes&&e.values.makes[0]&&n.find('select[name=make] option[value="'+e.values.makes[0]+'"]').prop("selected",!0),e.values.models&&e.values.models[0]&&n.find('select[name=model] option[value="'+e.values.models[0]+'"]').prop("selected",!0),e.values.propellants&&e.values.propellants[0]&&n.find('select[name=propellant] option[value="'+e.values.propellants[0]+'"]').prop("selected",!0),e.values.bodyTypes&&e.values.bodyTypes[0]&&n.find('select[name=bodyType] option[value="'+e.values.bodyTypes[0]+'"]').prop("selected",!0),e.values.productTypes&&e.values.productTypes[0]&&n.find('select[name=productType] option[value="'+e.values.productTypes[0]+'"]').prop("selected",!0),e.values.vehicleStates&&e.values.vehicleStates[0]&&n.find('select[name=vehicleState] option[value="'+e.values.vehicleStates[0]+'"]').prop("selected",!0))},complete:function(){s=null,f()}}))},this.SaveUserFilterSettings=function(){v(),h(),p()},this.ResetFilter=function(){v(),u=null;var e=window.location.pathname.split("/");window.history.replaceState(null,null,"/"+e[1]+"/"),p()},this.ResetFrontpageFilter=function(){v(),f()},this.Init()}function FormatPrice(e,n){return-1===e?e:e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")+(n?",-":"")}jQuery(function(e){var n=new Biltorvet(e);e(document).on("change",".bdtSlider",function(n){var l=n.value.newValue[0],t=n.value.newValue[1];"priceRange"===e(n.target).attr("id")&&(l=FormatPrice(l,!1),t=FormatPrice(t,!0)),-1===l&&(l=""),-1===t&&(t=""),e(this).closest(".bdtSliderContainer").find(".bdtSliderMinVal").text(l).end().find(".bdtSliderMaxVal").text(t)}).on("slideStop",".bdtSlider",function(e){n.ReloadUserFilterSelection(!1)}).on("click",".bdt .reset",function(l){l.preventDefault(),e(this).closest(".bdt .vehicle_search").find("select").val(""),n.ResetFilter()}).on("click",".bdt .resetFrontpage",function(l){l.preventDefault(),e(this).closest(".bdt .vehicle_search").find("select").val(""),n.ResetFrontpageFilter()}).on("click",".bdt .search",function(e){e.preventDefault(),n.SaveUserFilterSettings()}).on("change",".bdt .vehicle_search_results",function(){n.SaveUserFilterSettings()}).on("blur",".fullTextSearch",function(){var l=e(this).closest(".bdt .vehicle_search");l.find("select[name=company]").val(""),l.find("select[name=vehicleState]").val(""),l.find("select[name=make]").val(""),l.find("select[name=model]").val(""),l.find("select[name=bodyType]").val(""),l.find("select[name=productType]").val(""),l.find("select[name=propellant]").val(""),l.find("select[name=priceMinMax]").val(""),l.find("select[name=priceMinMax]").val(""),l.find("select[name=consumptionMin]").val(""),l.find("select[name=consumptionMax]").val(""),n.ReloadUserFilterSelection(!1)}).on("change",".bdt .vehicle_search select",function(){var l=e(this).closest(".bdt .vehicle_search");"make"===e(this).attr("name")&&l.find("select[name=model]").val("").trigger("change"),"model"===e(this).attr("name")&&(l.find("select[name=bodyType]").val(""),l.find("select[name=productType]").val(""),l.find("select[name=propellant]").val(""),l.find("select[name=priceMinMax]").val(""),l.find("select[name=priceMinMax]").val(""),l.find("select[name=consumptionMin]").val(""),l.find("select[name=consumptionMax]").val("")),"vehicleState"===e(this).attr("name")&&(l.find("select[name=make]").val(""),l.find("select[name=model]").val(""),l.find("select[name=bodyType]").val(""),l.find("select[name=productType]").val(""),l.find("select[name=propellant]").val(""),l.find("select[name=priceMinMax]").val(""),l.find("select[name=priceMinMax]").val(""),l.find("select[name=consumptionMin]").val(""),l.find("select[name=consumptionMax]").val("")),"company"===e(this).attr("name")&&(l.find("select[name=vehicleState]").val(""),l.find("select[name=make]").val(""),l.find("select[name=model]").val(""),l.find("select[name=bodyType]").val(""),l.find("select[name=productType]").val(""),l.find("select[name=propellant]").val(""),l.find("select[name=priceMinMax]").val(""),l.find("select[name=priceMinMax]").val(""),l.find("select[name=consumptionMin]").val(""),l.find("select[name=consumptionMax]").val("")),n.ReloadUserFilterSelection(!1)})});